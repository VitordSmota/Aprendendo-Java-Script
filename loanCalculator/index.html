<!DOCTYPE html>
<html lang="en"
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Loan Calculator</title>
    <style>
        .output { font-weight: bold; } /* valores calculados em negrito*/
        #payment {text-decoration: underline;}
        #graph {border: 1px solid black;}
        th, td { vertical-align: top;} /* Não centraliza células da tabela*/    
    </style>
</head>
<body>
    <table>
          <tr>
               <th>
                    Enter Loan Data:
               </th>
          
               <td></td>
          
               <th>
                    Loan Balance, Cumulative Equity, and Interest Payments
               </th>
          </tr>
          
          <tr>
               <td>
                    Amount of the loan ($):
               </td>
          
               <td>
                    <input id="amount" onchange="calculate();" />
               </td>
          
               <td rowspan="8">
                    <canvas id="graph" width="400" height="250"></canvas>
               </td>
          </tr>
          
          <tr>
               <td>
                    Annual interest (%):
               </td>
          
               <td>
                    <input id="apr" onchange="calculate();" />
               </td>
          </tr>
          
          <tr>
               <td>
                    Repayment period (years):
               </td>
          
               <td>
                    <input id="years" onchange="calculate();" />
               </td>
          </tr>
          
          <tr>
               <td>
                    Zipcode (to find lenders):
               </td>
          
               <td>
                    <input id="zipcode" onchange="calculate();" />
               </td>
          </tr>
          
          <tr>
               <th>
                    Aproximate Payments
               </th>
               <td>
                    <button onclick="calculate();" /> Calculate </button>
               </td>
          </tr>
          
          <tr>
               <td>
                    Monthly Payment
               </td>
               <td>
                    $<span class="output" id="payment"></span>
               </td>
          </tr>
          
          <tr>
               <td>
                    Total Payment:
               </td>
               <td>
                    $<span class="output" id="total"> </span>
               </td>
          </tr>
          
          <tr>
               <td>
                    Total Interest:
               </td>
               <td>
                    $<span class="output" id="totalinterest"> </span>
               </td>
          </tr>
          
          <tr>
               <th>
                    Sponsors:
               </th>
               <td colspan="2">
                    Apply for your loan with one of these fine lenders:
                    <div id="lenders"></div>
               </td>
          </tr>
    </table>
     <script>
          "use strict";
     /* Este script define a função calculate() chamada pelas rotinas de tratamento
     de evento no código HTML acima. A função lê valores de elementos <input>, calcula as informações 
     de pagamento de empréstimos, exibe o resultado em elementos <span>.
     Também salva os dados do usuário, exibe links para financeiras e desenha um gráfico 
     */

     function calculate() {
          // Pesquisa os elementos de entrada e saída no documento 
          var amount = document.getElementById("amount");
          var apr = document.getElementById("apr");
          var years = document.getElementById("years");
          var zipcode = document.getElementById("zipcode");
          var payment = document.getElementById("payment");
          var total = document.getElementById("total");
          var totalinterest = document.getElementById("totalinterest");
          
          /* Obtém a entrada do usuário através dos elementos de entrada. Presume que tudo isso
          é válido.
          Converte os juros de porcentagem para o período de pagamento em anos
          para o número de pagamentos mensais
          */
          var principal = parseFloat(amount.value);
          var interest = parseFloat(apr.value) / 100 /12;
          var payments = parseFloat(years.value) * 12;
          console.log(principal, interest, payment);
          
          /* Agora calcula o valor do pagamento mensal.*/
          var x = Math.pow(1 + interest, payments); // Math.pow() calcula potências 
          var monthly = (principal * x * interest) / (x-1);

          // Se o resultado é um número finito, a entrada do usuário estava correta e 
          // temos resultados significativos para exibir 

          if(isFinite(monthly)) {
               // Preenche os campos de saída, arrendondando para 2 casas decimais
               payment.innerHTML = monthly.toFixed(2);
               total.innerHTML = (monthly * payments).toFixed(2);
               totalinterest.innerHTML = ((monthly * payments) - principal).toFixed(2);

               // Salva a entrada do usuário para que possamos recuperá-la na próxima vez que 
               // ele visitar 
               save(amount.value, apr.value, years.value, zipcode.value);

               // Anúncio: localiza e exibe financeiras locais, mas ignora erros de rede
               
               try { // Captura quaisquer errors que ocorram dentro destas chaves
       
                    getLenders(amount.value, apr.value, years.value, zipcode.value);                    

               } 
               catch (e) { /* E ignora esses erros*/}
               
               // Por fim, traça o gráfico do saldo devedor, dos juros e dos pagamentos do capital

               chart(principal, interest, monthly, payments);
          } 
          else { 
               // O resultado foi Not-a-Number ou infinito, o que significa que a entrada
               // estava incompleta ou era inválida. Apaga qualquer saída exibida anteriormente.

               payment.innerHTML =""; // apaga o conteúdo desses elementos
               total.innerHTML =""; 
               totalinterest.innerHTML =""; 
               chart(); // Sem argumentos, apaga o gráfico           
          }
          
     }
     

     </script>
</body>
</html>